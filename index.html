<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞–ª–æ–†–∏—Å–∞ ‚Äî Snake</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#111;--panel:#1c1c1c;--canvas:#000;
  --text:#fff;--accent:#ff6b9a;
}
body.light{
  --bg:#f3f3f3;--panel:#fff;--canvas:#e6e6e6;--text:#111;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:var(--bg);color:var(--text);
  font-family:system-ui;
  display:flex;flex-direction:column;align-items:center;
  height:100vh;touch-action:none;
}
header{
  width:100%;padding:10px;
  display:flex;justify-content:space-between;align-items:center;
  background:var(--panel);
}
.title{
  font-family:'Press Start 2P';
  font-size:14px;color:var(--accent);
}
.btn-ui{
  padding:6px 10px;border-radius:10px;
  background:#222;font-size:14px;
}
canvas{
  background:var(--canvas);
  border-radius:12px;margin:10px 0;
}
.controls{
  display:grid;
  grid-template-columns:repeat(3,70px);
  grid-template-rows:repeat(2,70px);
  gap:10px;
}
.btn{
  background:#222;border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  font-size:26px;
}
.btn:active{background:var(--accent)}

.overlay{
  position:fixed;inset:0;background:var(--bg);
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;z-index:10;
}
.logo{
  font-family:'Press Start 2P';
  font-size:24px;color:var(--accent);
  animation:float 2.5s ease-in-out infinite;
}
@keyframes float{
  0%{transform:translateY(0)}
  50%{transform:translateY(-12px)}
  100%{transform:translateY(0)}
}
.pixel-btn{
  font-family:'Press Start 2P';
  padding:14px 26px;border-radius:14px;
  background:var(--accent);color:#000;
  margin-top:24px;
}
</style>
</head>

<body>

<div class="overlay" id="startScreen">
  <div class="logo">–ú–ê–õ–û–†–ò–°–ê</div>
  <div class="pixel-btn" id="playBtn">–ò–ì–†–ê–¢–¨</div>
</div>

<div class="overlay" id="gameOverScreen" style="display:none">
  <div class="logo" style="font-size:18px">GAME OVER</div>
  <div style="font-family:'Press Start 2P';font-size:12px;margin-top:10px">
    –†–ï–ö–û–†–î: <span id="finalRecord">0</span>
  </div>
  <div class="pixel-btn" id="restartBtn">–°–ù–û–í–ê</div>
</div>

<header>
  <span id="score">0</span>
  <span class="title">–ú–ê–õ–û–†–ò–°–ê</span>
  <span style="display:flex;gap:6px">
    <span id="record">0</span>
    <span class="btn-ui" id="pauseBtn">‚è∏</span>
    <span class="btn-ui" id="soundBtn">üîä</span>
  </span>
</header>

<canvas id="game" width="320" height="320"></canvas>

<div class="controls">
  <div></div><div class="btn" id="up">‚ñ≤</div><div></div>
  <div class="btn" id="left">‚óÄ</div><div class="btn" id="down">‚ñº</div><div class="btn" id="right">‚ñ∂</div>
</div>

<script>
/* ===== –ó–í–£–ö ===== */
const audioCtx = new (window.AudioContext||window.webkitAudioContext)()
let soundEnabled = true
let musicTimer

function tone(freq,dur=0.1,type="square"){
  if(!soundEnabled) return
  const o=audioCtx.createOscillator()
  const g=audioCtx.createGain()
  o.type=type
  o.frequency.value=freq
  g.gain.value=0.08
  o.connect(g).connect(audioCtx.destination)
  o.start()
  o.stop(audioCtx.currentTime+dur)
}

/* —ç—Ñ—Ñ–µ–∫—Ç—ã */
const soundEat=()=>{tone(900,0.05);setTimeout(()=>tone(1200,0.05),60)}
const soundCrash=()=>tone(200,0.3,"sawtooth")
const soundStart=()=>tone(500,0.15)

/* ===== –§–ò–†–ú–ï–ù–ù–´–ô 8-BIT –¢–†–ï–ö –ú–ê–õ–û–†–ò–°–ê ===== */
const malorisaTrack = [
  660,0,880,0,990,880,
  660,0,660,880,
  990,0,880,0,660
]
let noteIndex=0

function startMusic(){
  if(musicTimer) return
  musicTimer=setInterval(()=>{
    const note=malorisaTrack[noteIndex]
    if(note) tone(note,0.12,"triangle")
    noteIndex=(noteIndex+1)%malorisaTrack.length
  },180)
}
function stopMusic(){
  clearInterval(musicTimer)
  musicTimer=null
}

/* ===== –ò–ì–†–ê ===== */
const canvas=document.getElementById("game")
const ctx=canvas.getContext("2d")
const box=20
const cols=canvas.width/box
const rows=canvas.height/box
const foods=["üç£","üçî","üçü","üçï"]

let snake,dir,food,score
let paused=true
let record=localStorage.getItem("malorisa_record")||0
record.innerText=record

function start(){
  snake=[{x:10,y:10}]
  dir={x:1,y:0}
  score=0
  paused=false
  score.innerText=0
  spawnFood()
  startMusic()
}

function spawnFood(){
  food={
    x:Math.floor(Math.random()*cols),
    y:Math.floor(Math.random()*rows),
    icon:foods[Math.floor(Math.random()*foods.length)]
  }
}

function gameOver(){
  paused=true
  stopMusic()
  soundCrash()
  if(score>record){
    record=score
    localStorage.setItem("malorisa_record",record)
  }
  finalRecord.innerText=record
  gameOverScreen.style.display="flex"
}

function update(){
  if(paused) return
  const head={x:(snake[0].x+dir.x+cols)%cols,y:(snake[0].y+dir.y+rows)%rows}
  if(snake.some(p=>p.x===head.x&&p.y===head.y)){gameOver();return}
  snake.unshift(head)
  if(head.x===food.x&&head.y===food.y){
    score++;score.innerText=score
    soundEat();spawnFood()
  }else snake.pop()
}

function draw(){
  ctx.fillStyle=getComputedStyle(document.body).getPropertyValue('--canvas')
  ctx.fillRect(0,0,canvas.width,canvas.height)
  ctx.font="18px serif"
  ctx.fillText(food.icon,food.x*box+2,food.y*box+18)
  ctx.fillStyle="#ff6b9a"
  snake.forEach(p=>ctx.fillRect(p.x*box,p.y*box,box-2,box-2))
}

setInterval(()=>{update();draw()},150)

/* —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
function setDir(x,y){
  if(dir.x!==-x&&dir.y!==-y) dir={x,y}
}
up.onclick=()=>setDir(0,-1)
down.onclick=()=>setDir(0,1)
left.onclick=()=>setDir(-1,0)
right.onclick=()=>setDir(1,0)

pauseBtn.onclick=()=>{
  paused=!paused
  pauseBtn.innerText=paused?"‚ñ∂":"‚è∏"
  paused?stopMusic():startMusic()
}

soundBtn.onclick=()=>{
  soundEnabled=!soundEnabled
  soundBtn.innerText=soundEnabled?"üîä":"üîá"
}

playBtn.onclick=()=>{
  startScreen.style.display="none"
  soundStart()
  start()
}
restartBtn.onclick=()=>{
  gameOverScreen.style.display="none"
  soundStart()
  start()
}
</script>

</body>
</html>
